
#EXTRA_CFLAGS := -DUPMT_S

ifneq ($(KERNELRELEASE),)
	$(shell echo BLOCCO_1)
	obj-m		:= upmt.o
	upmt-objs 	:= upmt_main.o upmt_stamp.o upmt_util.o upmt_tunt.o upmt_paft.o upmt_tsa.o upmt_genl.o upmt_netfilter.o upmt_dev.o upmt_encap.o upmt_locks.o upmt_spl.o upmt_mdl.o upmt_s.o
else
	$(shell echo BLOCCO_2)
	KDIR1	:= /lib/modules/$(shell uname -r)/build
	KDIR2	:= /hosthome/linux-$(shell uname -r)
	KARCH	:= $(KDIR)/arch/um
	PWD		:= $(shell pwd)

default:
	$(MAKE) CONFIG_DEBUG_SECTION_MISMATCH=y -C $(KDIR1) SUBDIRS=$(PWD) modules
	
um:
	$(MAKE) ARCH=um CONFIG_DEBUG_SECTION_MISMATCH=y -C $(KDIR2) SUBDIRS=$(PWD) modules
	
endif

clean:
	rm -rf *.o *~ core .depend .*.cmd *.ko *.mod.c *.markers *.symvers *.order .*.o.d .tmp_versions

